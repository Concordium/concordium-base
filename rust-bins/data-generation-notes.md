This document describes how to generate various data items that are needed for testing, and inclusion in genesis blocks.

# Genesis data

The genesis block contains several complex data items that need to be generated with tools in this repository.
These are
- global cryptographic parameters
- initial identity providers
- initial anonymity revokers
- initial bakers
- initial accounts with credentials

## Global cryptographic parameters

At the moment this is a group generator and a shared commitment key. This is likely to be extended in the future.

A fresh set of global parameters can be generated by the [client](./src/bin/client.rs) tool as follows
```console
client generate-global --out-file global.json
```

The client is self-documenting, so please consult the `--help` option for details.

**It is important that all subsequent parameters are generated with a consistent set of global parameters.**

## Initial identity providers and anonymity revokers

The full command to generate a fresh set of identity providers and anonymity revokers is 
```console
client generate-ips --global global.json --key-capacity 30 --num 10 --num-ars 5 --out-dir database
```

This will generate
- 10 identity providers
- 5 anonymity revokers
- each of the identity providers has a key that can sign 30 attributes (this is attributes in total, the number of user-chosen attributes is a bit less)
- the global parameters should be available in `global.json`

The output will be written to the directory `database`. For each identity provider there will be two files
- identity_provider-$N.json
- identity_provider-$N.pub.json

containting all and just the private information about the `$N`-th identity provider.

For each anonymity revoker there will be analogous two files.

In addition, two files `identity_providers.json` and `anonymity_revokers.json` will be produced. They include the public parts of all identity providers and anonymity revokers.

These two files are needed to produce the genesis block.

## Initial bakers

The [genesis_tool](./src/bin/genesis_tool.rs) is used to generate the initial set of bakers.
The general form of the command is
```console
genesis_tool create-bakers --ars anonymity_revokers.json --balance 123 --global global.json --ip-data identity_provider-0.json --num 10 --num-finalizers 9 --num-keys 1 --out-dir bakers
```

This will create
- 10 bakers
- the first 9 of them will be in the initial finalization committee
- 10 accounts, each of them with balance 123. They are registered as the reward accounts for each of the bakers.
- each account only has one signing key, and each of them has one credential, signed by the given identity provider (given by `--ip-data`, which thus should point to a file with public and private information on the identity provider)

The result of this command is in the directory specified (`bakers` in the example). It consists of
- for each baker two files 
  - `baker-$N-account.json`
  - `baker-$N-credentials.json`
The first one contains public and private data for the account associated with the baker, the second one contains the baker's keys that allow it to sign blocks, participate in election, and finalization. Bakers can be started up with the `baker-$N-credentials.json` file.
- the file `bakers.json`. This file is needed to produce the genesis block. It includes information about whether the baker should be included in the initial finalization committee or not.

## Additional accounts

Additional accounts can be created with the command

```console
genesis_tool create-accounts --ars anonymity_revokers.json --balance 123 --global global.json --ip-data identity_provider-0.json --num 10 --num-keys 1 --out-dir accounts --template account 
```

The arguments with the same name as in the previous section have the same meaning. The additional arguments are
- `--template` which dictates how the account files will be named

The result of running this command is
- for each account a file `account-$N.json` (if `template` is set to `account`)
- a file `accounts.json` which contains all of the public information about all of the accounts. This file can be included as `additional-accounts` in the genesis block.

## Files needed to produce the genesis block.

Here is a summary of files that are needed for making the genesis block
- `accounts.json`
- `bakers.json`
- `identity-providers.json`
- `anonymity-revokers.json`

# Data for the wallet-proxy

The wallet proxy serves identity providers and anonymity revokers for the mobile wallet.
To streamline the process it groups some anonymity revokers with identity providers. To make the file suitable for serving by the wallet-proxy the [client](./src/bin/client.rs) has a command `extend-ip-list`.
This command can be used repeatedly to update the given file with additional anonymity revokers.

```console
client extend-ip-list --ip database/identity_provider-0.pub.json --metadata metadata-dev.json --selected-ars 3 4 5 --ips-with-metadata identity-providers-with-metadata.json
```

This will add a new entry to the list in `identity-providers-with-metadata.json` that will associate `identity_provider-0.pub.json` with metadata in `metadata-dev.json` and anonymity revokers with identities 3, 4, and 5. If `identity-providers-with-metadata.json` does not exist it will be created.

The list of anonymity revokers can be given with an additional argument `--ars`, and it should be in the same format as the file `anonymity_revokers.json` produced by `generate-ips`.

The file with metadata must be in the format
```json
{
      "issuanceStart": "https://idiss.notabene.id/idiss/authorize?idv=dev",
      "icon": "<base64 encoding of a png>"
}
```